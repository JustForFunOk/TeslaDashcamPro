<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选择视频文件</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body style="background-color: gray;">
    <h1>选择视频文件</h1>
    <button id="select-folder">选择文件夹</button>
    <ul id="saved-video-list"></ul>
    <ul id="sentry-video-list"></ul>
    <ul id="all-video-list"></ul>

    <script>
        const selectFolderButton = document.getElementById('select-folder');
        const savedVideoList = document.getElementById('saved-video-list');
        const sentryVideoList = document.getElementById('sentry-video-list');
        const allVideoList = document.getElementById('all-video-list');

        // 加载已保存的视频列表（如果存在）
        function loadSavedVideoList() {
            const savedVideoFiles = JSON.parse(sessionStorage.getItem('videoFiles'));

            if (savedVideoFiles) {
                showClipsGroups(savedVideoFiles);
            }
        }

        // 初始加载时恢复状态，这个需要，否则从视频播放页面退回时将是空白页面
        window.onload = loadSavedVideoList;

        selectFolderButton.addEventListener('click', async () => {
            // 调用 Electron API 选择文件夹
            const videoFiles = await window.electronAPI.selectFolder();

            // 保存视频列表到sessionStorage本地应用运行期间都可以获取其中的内容
            sessionStorage.setItem('videoFiles', JSON.stringify(videoFiles));

            showClipsGroups(videoFiles);
        });

        function showClipsGroups(videoFiles) {
            // 清空视频列表
            savedVideoList.innerHTML = '';
            sentryVideoList.innerHTML = '';
            allVideoList.innerHTML = '';

            // SavedClips
            if (videoFiles["SavedClips"].length > 0) {
                // 倒序显示
                for (let i = videoFiles["SavedClips"].length - 1; i >= 0; i--) {
                    // 在列表中创建一个项目
                    const li = document.createElement('li');
                    // 创建一个可点击的链接
                    const link = document.createElement('a');

                    link.href = `../video_player/index.html?type=${encodeURIComponent("SavedClips")}&index=${encodeURIComponent(i)}`;
                    link.textContent = videoFiles["SavedClips"][i].timestamp;  // 显示时间戳
                    li.appendChild(link);
                    savedVideoList.appendChild(li);
                }
            }

            if (videoFiles["SentryClips"].length > 0) {
                // 倒序显示
                for (let i = videoFiles["SentryClips"].length - 1; i >= 0; i--) {
                    // 在列表中创建一个项目
                    const li = document.createElement('li');
                    // 创建一个可点击的链接
                    const link = document.createElement('a');

                    link.href = `../video_player/index.html?type=${encodeURIComponent("SentryClips")}&index=${encodeURIComponent(i)}`;
                    link.textContent = videoFiles["SentryClips"][i].timestamp;  // 显示时间戳
                    li.appendChild(link);
                    savedVideoList.appendChild(li);
                }
            }

            if (videoFiles["AllClips"].length > 0) {
                // 倒序显示
                for (let i = videoFiles["AllClips"].length - 1; i >= 0; i--) {
                    // 在列表中创建一个项目
                    const li = document.createElement('li');
                    // 创建一个可点击的链接
                    const link = document.createElement('a');

                    link.href = `../video_player/index.html?type=${encodeURIComponent("AllClips")}&index=${encodeURIComponent(i)}`;
                    link.textContent = videoFiles["AllClips"][i].timestamp;  // 显示时间戳
                    li.appendChild(link);
                    savedVideoList.appendChild(li);
                }
            }
        }
    </script>
</body>

</html>